<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>도서검색</title>
    <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1'>
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.js"></script>
    <style>
        #list img{width: 60px; height: 80px;}
    </style>
</head>
<body>
    <!-- 도서목록 페이지 -->
    <div data-role="page" id="main">
        <div data-role="header" data-theme="b" data-position="fixed">
            <!-- <a href="#" data-icon="back">Back</a> -->
            <a href="index.html" data-icon="home" data-iconpos="notext" target="_self">Home</a>
            <h2>도서검색</h2>
        </div>
        <div data-role="content">
            <input type="text" id="txtQuery" value="jQuery">
            <ul data-role="listview" id="list" style="margin: 18px 0;"></ul>
            <script id="temp" type="text/x-handlebars-template">
                {{#each documents}}
                    <li>
                        <a href="#sub" title="{{title}}" contents="{{contents}}" price="{{price}}" authors="{{authors}}">
                            <img src="{{thumbnail}}">{{{title}}}
                        </a>
                    </li>
                {{/each}}
            </script>
            <input type="button" id="btnMore" value="더보기">
        </div>
        <div data-role="footer" data-theme="b" data-position="fixed">
            <h2>인천일보 아카데미 홍길동</h2>
        </div>
    </div>

    <!-- 도서정보 페이지 -->
    <div data-role="page" id="sub">
        <div data-role="header" data-theme="b" data-position="fixed">
            <a href="index.html" data-icon="home" data-iconpos="notext" target="_self">Home</a>
            <h2>도서정보</h2>
            <a href="#main" data-icon="back" data-iconpos="notext" target="_self">Back</a>
        </div>
        <div data-role="content" style="border: 2px solid gray; margin: 10px; border-radius: 10px;">
            <img src="" id="image" width=120 height=150><hr>
            <h5 id="title"></h5><hr>
            <h5 id="authors"></h5><hr>
            <p id="contents"></p>
        </div>
        <div data-role="footer" data-theme="b" data-position="fixed">
            <h2>인천일보 아카데미 홍길동</h2>
        </div>
    </div>
</body>
<script>
    var size = 10;
    getList();
    $("#list").on("click", "a", function(){
        var title = $(this).attr("title");
        var authors = $(this).attr("authors");
        var contents = $(this).attr("contents");
        var price = $(this).attr("price");
        var image = $(this).find("img").attr("src");
        $("#image").attr("src", image);
        $("#title").html(title);
        $("#authors").html(authors + " (" + price + "원)");
        $("#contents").html(contents);
    });
    $("#txtQuery").on("keydown", function(e){
        if(e.keyCode == 13){
            getList();
        }
    });
    $("#btnMore").on("click", function(){
        size += 5;
        getList();
    });

    function getList(){
        var query=$("#txtQuery").val();
        $.ajax({
            type:"get",
            url:"https://dapi.kakao.com/v3/search/book?target=title",
            headers:{"Authorization": "KakaoAK b16b87dfd25d35b3c5f76454375203c2"},
            data:{"query":query, "size":size},
            dataType:"json",
            success:function(data){
                var temp = Handlebars.compile($("#temp").html());
                $("#list").html(temp(data)).listview("refresh");
            }
        });
    }
</script>
</html>